DROP DATABASE IF EXISTS `POLICY-SYSTEM`;
CREATE DATABASE `POLICY-SYSTEM` /*!40100 DEFAULT CHARACTER SET UTF8MB4 COLLATE UTF8MB4_0900_AI_CI */ /*!80016 DEFAULT ENCRYPTION='N' */;
`
-- POLICY TABLE
CREATE TABLE `POLICY-SYSTEM`.`POLICY` (
    `ID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `POLICY_NUMBER` BIGINT NOT NULL,
    `ACCOUNT_NUMBER` BIGINT NOT NULL,
    `TYPE_CD` TINYINT(1) NOT NULL DEFAULT '1',
    `NAME` VARCHAR(45) NOT NULL,
    `EFFECTIVE_DATE` DATE NOT NULL,
    `EXPIRATION_DATE` DATE NOT NULL,
    `CANCEL_DATE` DATE NOT NULL,
    `TERM` SMALLINT NULL,
    `PREMIUM_AMOUNT` VARCHAR(10) NOT NULL,
    `CREATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`)
)  ENGINE=INNODB AUTO_INCREMENT=10 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- POLICY TYPE DETAILS
CREATE TABLE `POLICY-SYSTEM`.`POLICY_TYPE` (
    `ID` SMALLINT UNSIGNED NOT NULL,
    `TYPE_TXT` VARCHAR(25) NOT NULL,
    `CREATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`)
)  ENGINE=INNODB DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- POLICY STATUS TABLE
CREATE TABLE `POLICY-SYSTEM`.`POLICY_STATUS` (
    `ID` SMALLINT UNSIGNED NOT NULL,
    `STATUS_TXT` VARCHAR(25) NOT NULL,
    `CREATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`)
)  ENGINE=INNODB DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- POLICY RENEWAL
CREATE TABLE `POLICY-SYSTEM`.`POLICY_RENEWABLE` (
    ID VARCHAR(20) NOT NULL,
    DATE_OF_RENEWAL DATE NOT NULL,
    TYPE_OF_RENEWAL VARCHAR(15) NOT NULL,
    POLICY_ID SMALLINT UNSIGNED NOT NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(ID),
    KEY `IDX_FK_POLICY_ID` (`POLICY_ID`),
    CONSTRAINT `FK_POLICY_POLICY_RENEWAL` FOREIGN KEY (`POLICY_ID`) REFERENCES `POLICY` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- DRIVER TABLE
CREATE TABLE `POLICY-SYSTEM`.`DRIVER` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    STATUS_CD TINYINT(1) NOT NULL DEFAULT '1',
    POLICY_ID SMALLINT UNSIGNED NOT NULL,
    TITLE VARCHAR(10) NULL,
    FIRST_NAME VARCHAR(25) NOT NULL,
    LAST_NAME VARCHAR(25) NOT NULL,
    MIDDLE_INITIAL VARCHAR(2) NOT NULL,
    DOB DATE NOT NULL,
    EMAIL_ADDRESS NVARCHAR(50) NULL,
    PHONE_ID SMALLINT UNSIGNED NOT NULL,
    SSN NVARCHAR(50) NULL,
    LICENSE_ISSUED_DATE DATE NOT NULL,
    LICENSED_ISSUED_STATE VARCHAR(20) NOT NULL,
    LICENSE_NUMBER VARCHAR(20) NOT NULL,
    IS_PRIMARY_POLICY_HOLDER BOOLEAN,
    RELATION_WITH_PRIMARY_POLICY_HOLDER VARCHAR(25) NOT NULL,
    GENDER VARCHAR(25) NULL,
    MARITAL_STATUS VARCHAR(25) NOT NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID)
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- ADDRESS TABLE
CREATE TABLE `POLICY-SYSTEM`.`DRIVER_ADDRESS` (
    `ID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `TYPE` VARCHAR(10) NOT NULL,
    `DRIVER_ID` SMALLINT UNSIGNED NOT NULL,
    `STREET_NUMBER` VARCHAR(50) NOT NULL,
    `STREET_NAME` VARCHAR(50) DEFAULT NULL,
    `CITY` VARCHAR(50) DEFAULT NULL,
    `STATE` VARCHAR(20) NOT NULL,
    `POSTAL_CODE` VARCHAR(10) DEFAULT NULL,
    `IS_GARAGE_ADDRESS` TINYINT(1) NOT NULL DEFAULT '1',
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`),
    KEY `IDX_FK_DRIVER_ID` (`DRIVER_ID`),
    CONSTRAINT `FK_DRIVER_ADDRESS` FOREIGN KEY (`DRIVER_ID`) REFERENCES `DRIVER` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- BILL TABLE
CREATE TABLE `POLICY-SYSTEM`.`BILL` (
    `ID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `POLICY_ID` SMALLINT UNSIGNED NOT NULL,
    `BALANCE` VARCHAR(10) NOT NULL,
    `STATUS` TINYINT(1) NOT NULL DEFAULT '1',
    `DUE_DATE` DATE NOT NULL,
    `MINIMUM_PAYMENT` VARCHAR(10) DEFAULT NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`),
    KEY `IDX_FK_POLICY_ID` (`POLICY_ID`),
    CONSTRAINT `FK_POLICY_BILL` FOREIGN KEY (`POLICY_ID`) REFERENCES `POLICY` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=100 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;


-- PAYMENT TABLE
CREATE TABLE `POLICY-SYSTEM`.`PAYMENT` (
    `ID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `BILL_ID` SMALLINT UNSIGNED NOT NULL,
    `PAID_DATE` DATE NOT NULL,
    `AMOUNT` DOUBLE NOT NULL,
    `PAYMENT_METHOD` VARCHAR(25) NOT NULL,
    `PAYER_FIRST_NAME` VARCHAR(10) DEFAULT NULL,
    `PAYER_LAST_NAME` VARCHAR(10) DEFAULT NULL,
    `CARD_NUMBER` VARCHAR(50) NULL,
    `ZIPCODE` VARCHAR(10) NOT NULL,
    `CARD_EXPIRATION_DATE` DATE NULL,
    `CARD_TYPE` VARCHAR(25) NULL,
    `DEBIT_OR_CREDIT` VARCHAR(25) NULL,
    `BANK_NAME` VARCHAR(25) NULL,
    `ACCOUNT_NUMBER` VARCHAR(25) NULL,
    `ROUTING_NUMBER` VARCHAR(25) NULL,
    `CHECK_NUMBER` SMALLINT NULL,
    `CHECK_IMAGE` BLOB NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`ID`),
    KEY `IDX_FK_BILL_ID` (`BILL_ID`),
    CONSTRAINT `FK_BILL_PAYMENT` FOREIGN KEY (`BILL_ID`) REFERENCES `BILL` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=100 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- VEHICLE TABLE
CREATE TABLE `POLICY-SYSTEM`.`VEHICLE` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `STATUS` TINYINT(1) NOT NULL DEFAULT '1',
    POLICY_ID SMALLINT UNSIGNED NOT NULL,
    `YEAR` CHAR(4) NULL,
    MAKE VARCHAR(25) NOT NULL,
    MODEL VARCHAR(25) NOT NULL,
    COLOR VARCHAR(2)  NULL,
    TRIM VARCHAR(25) NULL,
    MILEAGE INTEGER NULL,
    VIN_NUMBER VARCHAR(20) NOT NULL,
    NUMBER_PLATE VARCHAR(10) NULL,
    REGISTERED_STATE VARCHAR(25) NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID),
    KEY `IDX_FK_POLICY_ID` (`POLICY_ID`),
    CONSTRAINT `FK_POLICY_VEHICLE` FOREIGN KEY (`POLICY_ID`) REFERENCES `POLICY` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

CREATE TABLE `POLICY-SYSTEM`.`VEHICLE_DRIVER` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    VEHICLE_ID SMALLINT UNSIGNED NOT NULL,
    DRIVER_ID SMALLINT UNSIGNED NOT NULL,
    BUSINESS_PURPOSE VARCHAR(25) NOT NULL,
    IS_PRIMARY_DRIVER BIT NULL,
    EVERYDAY_MILEAGE INTEGER  NULL,
    `STATUS` TINYINT(1) NOT NULL DEFAULT '1',
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID),
    KEY `IDX_FK_VEHICLE_ID` (`VEHICLE_ID`),
    CONSTRAINT `FK_VEHICLE_VEHICLE_DRIVER` FOREIGN KEY (`VEHICLE_ID`) REFERENCES `VEHICLE` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE,
    KEY `IDX_FK_DRIVER_ID` (`DRIVER_ID`),
    CONSTRAINT `FK_DRIVER_VEHICLE_DRIVER` FOREIGN KEY (`DRIVER_ID`) REFERENCES `DRIVER` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- COVERAGE TABLE
CREATE TABLE `POLICY-SYSTEM`.`COVERAGE` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    COVERAGE_GROUP VARCHAR(10) NULL,
    COVERAGE_DESCRIPTION VARCHAR(50) NULL,
    COVERAGE_CODE VARCHAR(5) NOT NULL,
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURREN`T_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID)
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- VEHICLE COVERAGE TABLE
CREATE TABLE `POLICY-SYSTEM`.`VEHICLE_COVERAGE` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    VEHICLE_ID SMALLINT UNSIGNED NOT NULL,
    COVERAGE_ID SMALLINT UNSIGNED NOT NULL,
    `STATUS` TINYINT(1) NOT NULL DEFAULT '1',
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID),
    KEY `IDX_FK_VEHICLE_ID` (`VEHICLE_ID`),
    CONSTRAINT `FK_VEHICLE_COVERAGE` FOREIGN KEY (`VEHICLE_ID`) REFERENCES `VEHICLE` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE,
    KEY `IDX_FK_COVERAGE_ID` (`COVERAGE_ID`),
    CONSTRAINT `FK_POLICY_VEHICLE_COVERAGE` FOREIGN KEY (`COVERAGE_ID`) REFERENCES `COVERAGE` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- POLICY COVERAGE TABLE
CREATE TABLE `POLICY-SYSTEM`.`POLICY_COVERAGE` (
    ID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    POLICY_ID SMALLINT UNSIGNED NOT NULL,
    COVERAGE_ID SMALLINT UNSIGNED NOT NULL,
    `STATUS` TINYINT(1) NOT NULL DEFAULT '1',
    `CREATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `LAST_UPDATED_DTS` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (ID),
    KEY `IDX_FK_POLICY_ID` (`POLICY_ID`),
    CONSTRAINT `FK_POLICY_COVERAGE` FOREIGN KEY (`POLICY_ID`) REFERENCES `POLICY` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE,
    KEY `IDX_FK_COVERAGE_ID` (`COVERAGE_ID`),
    CONSTRAINT `FK_COVERAGE_POLICY_COVERAGE` FOREIGN KEY (`COVERAGE_ID`) REFERENCES `COVERAGE` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
)  ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8MB4 COLLATE = UTF8MB4_0900_AI_CI;

-- REFERENCE DATA
DROP TABLE IF EXISTS `POLICY-SYSTEM`.REFERENCE_DATA;
CREATE TABLE `POLICY-SYSTEM`.REFERENCE_DATA (
    REFERENCE_DATA_ID INT NOT NULL,
    REFERENCE_DATA_CODE INT NOT NULL,
    DESCRIPTION NVARCHAR(50) NOT NULL,
    ROW_CRTD_DTS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_LAST_UPDTD_DTS TIMESTAMP DEFAULT NOW() ON UPDATE NOW(),
    PRIMARY KEY (REFERENCE_DATA_ID)
)  ENGINE=INNODB COMMENT='TABLE STRUCTURE FOR TABLE REFERENCE_DATA';

-- =============================================================================================

